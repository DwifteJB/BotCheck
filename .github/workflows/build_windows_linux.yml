name: "Nightly"

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  Ubuntu:

    runs-on: ubuntu-latest


    steps:
    - uses: actions/checkout@v2
    - name: Setup Node
      uses: actions/setup-node@v1
      with:
        node-version: 10.x 
    - name: "Install Electron Builder"
      run: npm install electron-builder -g
    - name: "Install Dependencies"
      run: npm i
    - name: "Install Electron"
      run: npm i electron --save-dev
    - run: export GH_TOKEN=${{ secrets.GH_TOKEN}}
    - name: "Build Linux"
      run: electron-builder --linux deb
    - name: "Upload Linux"
      uses: actions/upload-artifact@v2
      with:
        name: "BotCheckNightly Linux-x64"
        path: "dist\\BotCheck Setup 1.0.0.deb"

  MacOS:

    runs-on: macos-latest

    steps:
    - uses: actions/checkout@v2
    - name: Setup Node
      uses: actions/setup-node@v1
      with:
        node-version: 10.x

    - name: "Install Electron Packager"
      run: npm install electron-packager -g
    - name: "Install Dependencies"
      run: npm i
    - name: "Install Electron"
      run: npm i electron --save-dev

    - name: "Build macos"
      run: electron-packager . BotCheckNightly --platform=darwin --arch=x64

    - name: "Upload OSX"
      uses: actions/upload-artifact@v2
      with:
        name: "BotCheckNightly OSX x64"
        path: BotCheckNightly-OSX-darwin-x64

  Windows:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v2
    - name: Setup Node
      uses: actions/setup-node@v1
      with:
        node-version: 12.x

    - name: "Install Electron Builder"
      run: npm install electron-builder -g
    - name: "Install Dependincies"
      run: npm install
    - name: "Install Electron"
      run: npm i --save-dev electron
    - run: SET GHTOKEN=${{ secrets.GH_TOKEN}}
    - name: "Build for Windows"
      run: electron-builder --win
    - name: "Upload Windows Build"
      uses: actions/upload-artifact@v2
      with:
        name: "BotCheck Nightly Win-x64"
        path: "dist\\BotCheck Setup 1.0.0.exe"
